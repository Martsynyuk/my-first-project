<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="keywords" content="">
<meta name="description" content="">
<title>project</title>

<link rel="stylesheet" type="text/css" href="/css/main.css">
<link rel="stylesheet" type="text/css" href="/css/reset.css">
<script src="/js/jquery-2.2.0.js"></script>
<script src="/js/jquery.cookie.js"></script>

</head>
<body>
<div class="main">
	<div class="header">
	<form name="selectcontact" method="POST">
		<a href="/"><img src="/img/logotip.png" alt="logotip"></a>
		<div class="header_menu">
			<ul>	 
				<li><a class="home" href="<?= $html->url(array()) ?>">Home</a> </li>
				<li> <a class="home" href=" <?= $html->url(array('controller'=>'users', 'action'=>'logout')) ?>">Logout</a> </li>
				<li><a class="home" class="letter" href="/">Cancel</a></li>	
				<li class="accept"><input type="submit" name="Select" value="Accept" formaction="/contacts/letter/"></li>			
			</ul>
		</div>
	</div>
	<div class="content">
		<div class="contact">		
			<table class="table" border="0">
				<tr class="top">
					<th class="all">
						 <?php if( empty ( $argument['all'] ) ) 
										{
											 echo	'<a onClick="check_all(obj=$(this))" href="' . $_SERVER ['REQUEST_URI'] . 'all">All</a>' ;
										}	
										else{
												echo '<a href="/contacts/select/';
												
												if( ! empty ($argument['sortFirst']) )
												{
													echo $argument['sortFirst'] . '/' ;
												}
												if( !empty($argument['sortSecond']))
												{
													echo $argument['sortSecond'] . '/';
												}												
												echo $page . '/';
											
												echo '"\>Off</a>';
										}					
						?>
					</th>
					
					<th class="table_menu">First Name
					
						<input onClick="sort('FirstNameUp', $('.active_sortSecond').attr('name'))"  
							<?= ( empty($argument['sortFirst']) || $argument['sortFirst']==='FirstNameUp') ? 'class="active_sortFirst"' : '' ;?> 
							class="sort" type="submit" name="FirstNameUp" value="&#8593" formaction="
								
									<?php if(!empty($argument['sortSecond']))
												{
													echo $html->url(array('controller'=>'contacts', 'action'=>'select', 'sortFirst'=>'FirstNameUp', 'sortSecond'=>$argument['sortSecond'] , 'page'=>$page )); 
												}
												else{
													echo $html->url(array('controller'=>'contacts', 'action'=>'select', 'sortFirst'=>'FirstNameUp', 'page'=>$page ));
												}					
									?>
							" >
						
						
						<input onClick="sort('FirstNameDown', $('.active_sortSecond').attr('name'))"
							<?= ( $argument['sortFirst']==='FirstNameDown' ) ? 'class="active_sortFirst"' : '' ;?>
							class="sort" type="submit" name="FirstNameDown" value="&#8595" formaction="

								<?php if(!empty($argument['sortSecond']))
											{
												echo $html->url(array('controller'=>'contacts', 'action'=>'select', 'sortFirst'=>'FirstNameDown', 'sortSecond'=>$argument['sortSecond'] , 'page'=>$page )); 
											}
											else{
												echo $html->url(array('controller'=>'contacts', 'action'=>'select', 'sortFirst'=>'FirstNameDown', 'page'=>$page ));
											}					
								?>
							">
						
						
					</th>
					<th class="table_menu">Last Name
					
						<input onClick="sort($('.active_sortFirst').attr('name'), 'LastNameUp')"
						 <?= ( empty($argument['sortSecond']) || $argument['sortSecond']==='LastNameUp' ) ? 'class="active_sortSecond"' : '' ;?>
							class="sort" type="submit" name="LastNameUp" value="&#8593" formaction=" 
									
									<?php if(!empty($argument['sortFirst']))
												{
													echo $html->url(array('controller'=>'contacts', 'action'=>'select', 'sortFirst'=>$argument['sortFirst'], 'sortSecond'=>'LastNameUp' , 'page'=>$page )); 
												}
												else{
													echo $html->url(array('controller'=>'contacts', 'action'=>'select', 'sortSecond'=>'LastNameUp', 'page'=>$page ));
												}					
									?>
							" >
					 
						
						<input onClick="sort($('.active_sortFirst').attr('name'), 'LastNameDown')"
							<?= ( $argument['sortSecond']==='LastNameDown' ) ? 'class="active_sortSecond"' : '' ;?>
							class="sort" type="submit" name="LastNameDown" value="&#8595" formaction=" 							
							
							<?php if(!empty($argument['sortFirst']))
												{
													echo $html->url(array('controller'=>'contacts', 'action'=>'select', 'sortFirst'=>$argument['sortFirst'], 'sortSecond'=>'LastNameDown' , 'page'=>$page )); 
												}
												else{
													echo $html->url(array('controller'=>'contacts', 'action'=>'select', 'sortSecond'=>'LastNameDown', 'page'=>$page ));
												}					
									?>
							">
					
					</th>
					<th class="table_menu">E-mail</th>
					<th class="cell_plase">Cellular</th>
				</tr>
					
			<?php foreach ( $contacts as $contact ) : ?>		
					<tr class="line">
					<td> 
						<input data="<?= $contact['id']; ?>" onClick="check(obj=$(this))" class="check" type="checkbox" name="<?= $contact['id']; ?>" value="<?= $contact['Email']; ?>" 
										
										<?php if( ! empty ($argument['all']) )
												{	
													echo 'checked';
												}
												elseif( ! empty ($checked) )
												{	
													foreach ( $checked as $check )
													{
														if ($contact['id'] == $check)
														{
															echo 'checked';
														}
													}
												}
												
										?>
						>
					</td>
					<td class="name"><?= $contact['FirstName']; ?></td>
					<td class="name"><?= $contact['LastName']; ?></td>
					<td class="emails"><?= $contact['Email']; ?></td>
					<td class="telephone"><?= $contact['Telephone']; ?></td>
					<?php $i++; ?>
				</tr>	
				
			<?php endforeach;?>	
											
			</table>
			<div class="pagination">
	 
				<ul>
					<li class="back_plase">
						<?php  if ($page != 1) : ?>
								
						<input onClick="pagination(<?= $page - 1?>)" class="back" type="submit" name="page" value="" formaction="<?php
						
										echo '/contacts/select/';
										
										if( ! empty ($argument['sortFirst']) )
										{
											echo $argument['sortFirst'] . '/' ;
										}
										if( !empty($argument['sortSecond']))
										{
											echo $argument['sortSecond'] . '/';
										}
										
										if ($page == 1) {
											echo '1/';
										} else {
											echo ($page - 1) . '/';
										}
										?>"
						>
										
								
								
							<?php endif; ?>	
																
					</li>
					
					<li class="page_plase">
							<?php for ($i = $count_for_pagin[0]; $i <= $count_for_pagin[1]; $i++) { ?>
									<?php if ($i == $page) { ?>
							
										<input onClick="pagination(<?= $i ?>)" class="page_active" type="submit" name="page" value="<?=$i?>" formaction="<?php
											
													echo '/contacts/select/';
														
													if( ! empty ($argument['sortFirst']) )
													{
														echo $argument['sortFirst'] . '/' ;
													}
													if( !empty($argument['sortSecond']))
													{
														echo $argument['sortSecond'] . '/';
													}
													echo $i . '/';
													
													?>"
											>
										
									<?php } else { ?>
											<input onClick="pagination(<?= $i?>)" class="page" type="submit" name="page" value="<?=$i?>" formaction="<?php
											
													echo '/contacts/select/';
														
													if( ! empty ($argument['sortFirst']) )
													{
														echo $argument['sortFirst'] . '/' ;
													}
													if( !empty($argument['sortSecond']))
													{
														echo $argument['sortSecond'] . '/';
													}
													echo $i . '/';
													
													?>"
											>
										<?php } ?>
								
							<?php } ?>
								
						</li>
					<li class="next_plase">								 
						<?php if ($page != $count_pages) : ?>
						
								<input onClick="pagination(<?= $page + 1?>)" class="next" type="submit" name="page" value="" formaction="<?php
								
										echo '/contacts/select/';
											
										if( ! empty ($argument['sortFirst']) )
										{
											echo $argument['sortFirst'] . '/' ;
										}
										if( !empty($argument['sortSecond']))
										{
											echo $argument['sortSecond'] . '/';
										}
									  echo ( $page + 1 ) . '/' ;
									  
									 ?>"
								 >
							
															
						<?php endif; ?>	
					</form>									
					</li>
				</ul>
			</div
		</div>
	</div>
	
	</div>
	
	<div class="footer">
		<span>&#169 2015 Wise Engineering</span>
	</div>
</div>
<script>

// pagination

$('tr.top input').on('click', function(e) {
	e.preventDefault();
});

$('tr.top a').on('click', function(e) {
	e.preventDefault();
});

$('div.pagination input').on('click',function(e){
	$('div.pagination a'), $(this).prop( 'disabled', true );
	  e.preventDefault();
	});

function pagination(page)
{		
	var sortFirst = $('.active_sortFirst').attr('name');
	var sortSecond = $('.active_sortSecond').attr('name');
			
	history.pushState(null, null, '/contacts/select/' + page + '/');
					
	$.ajax({
		type: 'post',
		url: '/contacts/ajax_select',
		data:{'page': page, 'first': sortFirst, 'second': sortSecond},
		response:'html',
		success: function(data){
		  $('.contact').empty();
			$('.contact').append(data);
		},
		error: function(data){
		}			  
	});
	
	setTimeout(function() {
		checked_checkbox();
	}, 100);
		
}		

function sort(sortFirst, sortSecond)
{
	
	var page = $('.page_active').val();
	
	history.pushState(null, null, '/contacts/select/' + page + '/');
					
	$.ajax({
		type: 'post',
		url: '/contacts/ajax_select',
		data:{'page': page, 'first': sortFirst, 'second': sortSecond},
		response:'html',
		success: function(data){
			
			$('.contact').empty();
			$('.contact').append(data);	
		},
		error: function(data){
			alert('error')
		}			  
	});
}

// checkbox

function check_all(obj)
{
	var lop = $(obj).text()
	
	if(lop == 'All')
	{			
		$("input:checkbox").prop("checked", true);
		$(obj).text('Off');
		$("input:checkbox").each(function(key, val){
			check(val);
		});
	}
	else
	{
		$("input:checkbox").prop("checked", false);
		$(obj).text('All');
		$("input:checkbox").each(function(key, val){
			check(val);
		});
	}
}

function check(obj)
{
	var check = $(obj).attr('data');
	
	if($(obj).is(':checked'))
	{
		
		if($.cookie('select') == null || $.cookie('select') == '')
		{
			$.cookie('select', check, {expires: 1, path: '/'});
		}
		else{
			check = check + ', ' + $.cookie('select');
			$.cookie('select', check, {expires: 1, path: '/'});
		}
	}
	else{
		
		if($.cookie('select') == null || $.cookie('select') == '')
		{
			
		}
		else{
			array = $.cookie('select').split(', ');
			jQuery.each(array, function(key, val){
			
				if(val == check)
					{
						array.splice($.inArray(val, array), 1);
					}
			});
			
			check = array.join(', ');
			
			$.cookie('select', check, {expires: 1, path: '/'});
		}
	 
	}
	
	array = $.cookie('select').split(', ');
	array = jQuery.unique(array)	
	check = array.join(', ');
			
	$.cookie('select', check, {expires: 1, path: '/'});
}

function checked_checkbox()
{
	
	if($.cookie('select') != null)
	{
		
		array = $.cookie('select').split(', ');
		
		$("input:checkbox").each(function(key, val){
			
			jQuery.each(array, function(key, value){
				
				if($(val).attr('data') == value )
					{
						$(val).prop("checked", true);
					}
			});
		});

	}
}
</script> 
</body>
</html>
